<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Visual Search - NIGO OFFICE</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,system-ui,sans-serif;background:#f5f5f5;color:#333;min-height:100vh;-webkit-tap-highlight-color:transparent}
.bar{background:#1a1a1a;display:flex;align-items:center;justify-content:space-between;padding:12px 16px;position:sticky;top:0;z-index:10}
.bar b{color:#D4AF37;font-size:15px;letter-spacing:2px}
.bar a{color:#999;font-size:13px;text-decoration:none}
.wrap{max-width:1200px;margin:0 auto;padding:12px}
input[type=file]{display:none!important}
.upload{background:#fff;border-radius:16px;padding:32px 20px;text-align:center;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.06)}
.upload h2{font-size:16px;font-weight:600;margin-bottom:4px}
.upload p{color:#999;font-size:13px;margin-bottom:20px}
.btns{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
.btn{display:flex;align-items:center;gap:8px;padding:14px 28px;border-radius:12px;border:none;font-size:15px;font-weight:500;cursor:pointer;transition:transform .1s}
.btn:active{transform:scale(.96)}
.btn-cam{background:#D4AF37;color:#fff}
.btn-gal{background:#f0f0f0;color:#333}
.hint{color:#bbb;font-size:12px;margin-top:16px}
.pv{display:none;background:#fff;border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.06);text-align:center}
.pv img{max-height:160px;max-width:100%;border-radius:12px;object-fit:contain}
.pv .re{display:inline-block;margin-top:12px;color:#D4AF37;font-size:14px;cursor:pointer;padding:8px 20px;border:1px solid #D4AF37;border-radius:8px}
#st{text-align:center;color:#999;font-size:13px;padding:8px 0}
.spin{display:inline-block;width:16px;height:16px;border:2px solid #D4AF37;border-top-color:transparent;border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle;margin-right:6px}
@keyframes sp{to{transform:rotate(360deg)}}
.g{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
.c{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.c a{text-decoration:none;color:#333}
.c img{width:100%;aspect-ratio:1;object-fit:cover;background:#f0f0f0}
.c .inf{padding:8px}
.c .tt{font-size:12px;line-height:1.4;height:34px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.c .bot{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.c .sc{font-size:11px;color:#D4AF37;font-weight:bold}
.c .lk{font-size:10px;color:#999}
@media(max-width:500px){.g{grid-template-columns:repeat(2,1fr);gap:6px}.wrap{padding:8px}.btn{padding:14px 20px;font-size:14px}}
</style>
</head>
<body>
<div class="bar">
  <b>NIGO OFFICE</b>
  <a href="https://www.nigooffice.com">‚Üê Shop</a>
</div>
<div class="wrap">
  <div class="upload" id="dz">
    <h2>üì∑ Find Similar Products</h2>
    <p>Take a photo or upload from gallery</p>
    <div class="btns">
      <button class="btn btn-cam" onclick="fc.click()">üì∑ Camera</button>
      <button class="btn btn-gal" onclick="fg.click()">üñº Gallery</button>
    </div>
    <p class="hint">Desktop: drag & drop or Ctrl+V paste</p>
    <input type="file" id="fc" accept="image/*" capture="environment">
    <input type="file" id="fg" accept="image/*">
  </div>
  <div class="pv" id="pv"><img id="pi"><br><span class="re" onclick="reset()">üîÑ Search Again</span></div>
  <div id="st"></div>
  <div class="g" id="rs"></div>
</div>
<script>
const C='https://cdn.staticsoe.com',S='https://www.nigooffice.com',A=location.origin+'/search';
const dz=document.getElementById('dz'),fc=document.getElementById('fc'),fg=document.getElementById('fg');
const pv=document.getElementById('pv'),pi=document.getElementById('pi');
const st=document.getElementById('st'),rs=document.getElementById('rs');

fc.onchange=e=>e.target.files[0]&&go(e.target.files[0]);
fg.onchange=e=>e.target.files[0]&&go(e.target.files[0]);
dz.ondragover=e=>{e.preventDefault()};
dz.ondrop=e=>{e.preventDefault();e.dataTransfer.files[0]&&go(e.dataTransfer.files[0])};
document.onpaste=e=>{const f=[...(e.clipboardData?.items||[])].find(i=>i.type.startsWith('image/'));f&&go(f.getAsFile())};

function reset(){pv.style.display='none';dz.style.display='block';rs.innerHTML='';st.textContent='';fc.value='';fg.value=''}

async function go(f){
  pi.src=URL.createObjectURL(f);
  pv.style.display='block';dz.style.display='none';
  rs.innerHTML='';
  const t0=Date.now();
  st.innerHTML='<span class="spin"></span>Searching 10,000+ products...';
  try{
    const r=await fetch(A,{method:'POST',body:await f.arrayBuffer()});
    if(!r.ok)throw new Error(r.status);
    const d=await r.json();
    const ms=Date.now()-t0;
    st.textContent=d.length+' matches ¬∑ '+((ms/1000).toFixed(1))+'s';
    rs.innerHTML=d.map(i=>{
      const img=(i.img.startsWith('http')?i.img:C+i.img)+'?x-oss-process=image/format,webp/resize,w_300';
      return`<div class="c"><a href="${S}/products/${i.handle}" target="_blank"><img src="${img}" loading="lazy"><div class="inf"><div class="tt">${i.title}</div><div class="bot"><span class="sc">${i.score}%</span><span class="lk">View ‚Üí</span></div></div></a></div>`
    }).join('');
  }catch(e){st.textContent='‚ùå '+e.message+' ‚Äî server may be waking up, retry in 30s'}
}
</script>
</body>
</html>
