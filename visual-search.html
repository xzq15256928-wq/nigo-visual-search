<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Visual Search - NIGO OFFICE</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,Arial,sans-serif;background:#f5f5f5;color:#333;min-height:100vh}
.bar{background:#1a1a1a;color:#D4AF37;text-align:center;padding:10px;font-size:15px;font-weight:bold;letter-spacing:2px}
.wrap{max-width:1200px;margin:0 auto;padding:12px}
.upload{background:#fff;border-radius:12px;padding:32px 16px;text-align:center;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.08)}
.upload .cam{width:56px;height:56px;background:#D4AF37;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
.upload .cam svg{width:28px;height:28px;fill:#fff}
.upload p{color:#999;font-size:13px;margin-top:8px}
.upload input{display:none}
.pv{display:none;background:#fff;border-radius:12px;padding:12px;margin-bottom:12px;box-shadow:0 1px 4px rgba(0,0,0,.08);text-align:center}
.pv img{max-height:120px;border-radius:8px}
.pv .re{display:inline-block;margin-left:12px;color:#D4AF37;font-size:13px;cursor:pointer;vertical-align:bottom;line-height:120px}
#st{text-align:center;color:#999;font-size:13px;padding:8px 0}
.g{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
.c{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.06)}
.c a{text-decoration:none;color:#333}
.c img{width:100%;aspect-ratio:1;object-fit:cover;background:#f0f0f0}
.c .inf{padding:8px}
.c .tt{font-size:12px;line-height:1.4;height:34px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.c .bot{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.c .sc{font-size:11px;color:#D4AF37;font-weight:bold}
.c .lk{font-size:10px;color:#999}
@media(max-width:500px){.g{grid-template-columns:repeat(2,1fr);gap:6px}.wrap{padding:8px}}
</style>
</head>
<body>
<div class="bar">NIGO OFFICE</div>
<div class="wrap">
  <div class="upload" id="dz">
    <div class="cam" onclick="document.getElementById('fi').click()">
      <svg viewBox="0 0 24 24"><path d="M12 15.2a3.2 3.2 0 100-6.4 3.2 3.2 0 000 6.4z"/><path d="M9 2L7.17 4H4a2 2 0 00-2 2v12a2 2 0 002 2h16a2 2 0 002-2V6a2 2 0 00-2-2h-3.17L15 2H9z"/></svg>
    </div>
    <p>Upload photo to find similar products</p>
    <input type="file" id="fi" accept="image/*">
  </div>
  <div class="pv" id="pv">
    <img id="pi"><span class="re" onclick="reset()">✕ Clear</span>
  </div>
  <div id="st"></div>
  <div class="g" id="rs"></div>
</div>
<script>
const C='https://cdn.staticsoe.com',S='https://www.nigooffice.com',A=location.origin+'/search';
const dz=document.getElementById('dz'),fi=document.getElementById('fi');
const pv=document.getElementById('pv'),pi=document.getElementById('pi');
const st=document.getElementById('st'),rs=document.getElementById('rs');

fi.onchange=e=>e.target.files[0]&&go(e.target.files[0]);
dz.ondragover=e=>{e.preventDefault();dz.style.borderColor='#D4AF37'};
dz.ondragleave=()=>dz.style.borderColor='transparent';
dz.ondrop=e=>{e.preventDefault();e.dataTransfer.files[0]&&go(e.dataTransfer.files[0])};
document.onpaste=e=>{const f=[...(e.clipboardData?.items||[])].find(i=>i.type.startsWith('image/'));f&&go(f.getAsFile())};

function reset(){pv.style.display='none';dz.style.display='block';rs.innerHTML='';st.textContent='';fi.value=''}

async function go(f){
  pi.src=URL.createObjectURL(f);
  pv.style.display='block';dz.style.display='none';
  rs.innerHTML='';st.textContent='Searching 10,000+ products...';
  try{
    const r=await fetch(A,{method:'POST',body:await f.arrayBuffer()});
    if(!r.ok)throw new Error(r.status);
    const d=await r.json();
    st.textContent=d.length+' similar products found';
    rs.innerHTML=d.map(i=>{
      const img=(i.img.startsWith('http')?i.img:C+i.img)+'?x-oss-process=image/format,webp/resize,w_300';
      return`<div class="c"><a href="${S}/products/${i.handle}" target="_blank"><img src="${img}" loading="lazy"><div class="inf"><div class="tt">${i.title}</div><div class="bot"><span class="sc">${i.score}% match</span><span class="lk">View →</span></div></div></a></div>`
    }).join('');
  }catch(e){st.textContent='Error: '+e.message}
}
</script>
</body>
</html>
