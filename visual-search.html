<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Visual Search - NIGO OFFICE</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#111;color:#fff;min-height:100vh}
.header{text-align:center;padding:30px 20px 10px}
.header h1{font-size:28px;letter-spacing:3px;color:#D4AF37}
.header p{color:#888;margin-top:8px;font-size:14px}
.upload-zone{max-width:500px;margin:20px auto;border:2px dashed #444;border-radius:12px;padding:40px 20px;text-align:center;cursor:pointer;transition:border-color .2s}
.upload-zone:hover,.upload-zone.drag{border-color:#D4AF37}
.upload-zone input{display:none}
.upload-zone .icon{font-size:48px;margin-bottom:12px}
.upload-zone p{color:#aaa;font-size:14px}
.preview{max-width:500px;margin:0 auto;text-align:center}
.preview img{max-height:200px;border-radius:8px;margin:10px 0}
.status{text-align:center;padding:10px;color:#D4AF37;font-size:14px}
.results{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;padding:20px;max-width:1200px;margin:0 auto}
.card{background:#1a1a1a;border-radius:8px;overflow:hidden;transition:transform .2s}
.card:hover{transform:scale(1.03)}
.card a{text-decoration:none;color:#fff}
.card img{width:100%;aspect-ratio:1;object-fit:cover;background:#222}
.card .info{padding:10px}
.card .title{font-size:12px;color:#ccc;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;line-height:1.4}
.card .score{font-size:11px;color:#D4AF37;margin-top:4px}
.paste-hint{text-align:center;color:#666;font-size:12px;margin-top:8px}
</style>
</head>
<body>
<div class="header">
  <h1>üîç NIGO OFFICE</h1>
  <p>Upload or paste a photo to find matching products from 10,000+ items</p>
</div>

<div class="upload-zone" id="dropZone">
  <div class="icon">üì∑</div>
  <p>Drop image here, click to upload, or <b>Ctrl+V</b> to paste</p>
  <input type="file" id="fileInput" accept="image/*">
</div>
<div class="paste-hint">Supports: JPG, PNG, WebP</div>

<div class="preview" id="preview" style="display:none">
  <img id="previewImg">
</div>
<div class="status" id="status"></div>
<div class="results" id="results"></div>

<script>
const CDN = 'https://cdn.staticsoe.com';
const SITE = 'https://www.nigooffice.com';
const API = location.origin + '/search';

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const preview = document.getElementById('preview');
const previewImg = document.getElementById('previewImg');
const status = document.getElementById('status');
const results = document.getElementById('results');

dropZone.onclick = () => fileInput.click();
fileInput.onchange = e => e.target.files[0] && doSearch(e.target.files[0]);

dropZone.ondragover = e => { e.preventDefault(); dropZone.classList.add('drag'); };
dropZone.ondragleave = () => dropZone.classList.remove('drag');
dropZone.ondrop = e => { e.preventDefault(); dropZone.classList.remove('drag'); if(e.dataTransfer.files[0]) doSearch(e.dataTransfer.files[0]); };

document.onpaste = e => {
  const f = [...(e.clipboardData?.items||[])].find(i => i.type.startsWith('image/'));
  if (f) doSearch(f.getAsFile());
};

async function doSearch(file) {
  preview.style.display = 'block';
  previewImg.src = URL.createObjectURL(file);
  results.innerHTML = '';
  status.textContent = 'üîç Searching 10,207 products...';

  try {
    const buf = await file.arrayBuffer();
    const r = await fetch(API, { method: 'POST', body: buf });
    if (!r.ok) throw new Error(`Server error ${r.status}`);
    const items = await r.json();
    status.textContent = `‚úÖ Found ${items.length} matches`;
    results.innerHTML = items.map(it => {
      const img = it.img.startsWith('http') ? it.img : CDN + it.img;
      const imgOpt = img + '?x-oss-process=image/format,webp/resize,w_400';
      const url = `${SITE}/products/${it.handle}`;
      return `<div class="card"><a href="${url}" target="_blank">
        <img src="${imgOpt}" loading="lazy" alt="${it.title}">
        <div class="info"><div class="title">${it.title}</div>
        <div class="score">${it.score}% match</div></div></a></div>`;
    }).join('');
  } catch(e) {
    status.textContent = '‚ùå ' + e.message;
  }
}
</script>
</body>
</html>
